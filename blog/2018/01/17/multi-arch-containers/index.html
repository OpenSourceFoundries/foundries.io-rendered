<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simplify your life: multi-architecture docker containers</title>
  <meta name="author" content="" />

  
  <meta name="keywords" content="microPlatform, osf, updates">	
  

  

  <meta name="generator" content="Hugo 0.31.1" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="https://opensourcefoundries.github.io/osfoundries-rendered/css/animate.css" rel="stylesheet">

  
  
    <link href="https://opensourcefoundries.github.io/osfoundries-rendered/css/style.default.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="https://opensourcefoundries.github.io/osfoundries-rendered/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="https://opensourcefoundries.github.io/osfoundries-rendered/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="https://opensourcefoundries.github.io/osfoundries-rendered/img/apple-touch-icon.png" />
  

  <link href="https://opensourcefoundries.github.io/osfoundries-rendered/css/owl.carousel.css" rel="stylesheet">
  <link href="https://opensourcefoundries.github.io/osfoundries-rendered/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://opensourcefoundries.github.io/index.xml" type="application/rss+xml" title="Open Source Foundries, Ltd.">

  
  <meta property="og:title" content="Simplify your life: multi-architecture docker containers" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/osfoundries-rendered/blog/2018/01/17/multi-arch-containers//" />
  <meta property="og:image" content="img/logo.png" />

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://opensourcefoundries.github.io/osfoundries-rendered/">
                    <img src="https://opensourcefoundries.github.io/osfoundries-rendered/img/logo.png" alt="Simplify your life: multi-architecture docker containers logo" class="hidden-xs hidden-sm">
                    <img src="https://opensourcefoundries.github.io/osfoundries-rendered/img/logo-small.png" alt="Simplify your life: multi-architecture docker containers logo" class="visible-xs visible-sm">
                    <span class="sr-only">Simplify your life: multi-architecture docker containers - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  

                    
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Product <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                          
                            <li><a href="/osfoundries-rendered/product/#overview">Overview</a></li>
                          
                            <li><a href="/osfoundries-rendered/product/#linux-microplatform">Linux microPlatform</a></li>
                          
                            <li><a href="/osfoundries-rendered/product/#zephyr-microplatform">Zephyr microPlatform</a></li>
                          
                            <li><a href="/osfoundries-rendered/product/#lifetime-support">Lifetime Support</a></li>
                          
                            <li><a href="/osfoundries-rendered/product/#pricing">Pricing</a></li>
                          
                        </ul>
                    
                  </li>
                  

                    
                        <li class="dropdown"><a href="/osfoundries-rendered/partners/">Partners</a>
                    
                  </li>
                  

                    
                        <li class="dropdown"><a href="/osfoundries-rendered/blog/">Blog</a>
                    
                  </li>
                  

                    
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                          
                            <li><a href="/osfoundries-rendered/about/#company">Company</a></li>
                          
                            <li><a href="/osfoundries-rendered/about/#investors">Investors</a></li>
                          
                            <li><a href="/osfoundries-rendered/about/#team">Team</a></li>
                          
                        </ul>
                    
                  </li>
                  

                    
                        <li class="dropdown" id="getstarted"><a href="https://foundries.io">Getting Started</a>
                    
                  </li>
                  
                </ul>
            </div>
            
            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Simplify your life: multi-architecture docker containers</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">January 17, 2018</p>

                        <div id="post-content">
                          

<h2 id="introduction">Introduction</h2>

<blockquote>
<p>“The great thing about Docker is that your developers run the exact same container as what runs in production.”</p>
</blockquote>

<p>This is what the Docker hype is about, creating reproducibile environments for applications. The technology enables us to create lightweight, secure microservices which run on an array of SoCs that can be updated over the air in a matter of seconds. We believe that accelerating code delivery will ultimately reduce time to market. Hype aside, Docker has matured and has become a foundational building block of our microPlatforms.</p>

<h2 id="complexity">Complexity</h2>

<p>The microPlatforms are built to be architecture agnostic, meaning we don&rsquo;t favor one over the other. This ensures any user will have the same experience no matter which architecture they may choose. This is a complex problem to solve when it comes to Docker containers, as each image layer is built for a specific architecture. That means to use a Docker container, a user needs to know the architecture they will use, otherwise the container simply won&rsquo;t function at runtime. The basics of the problem we&rsquo;ve solved is outlined below:</p>

<ul>
<li>Container base images must be created for each architecture.</li>
<li>A per architecture Dockerfile must be created to reference the proper base image.</li>
<li>Users must <em>know</em> the right image to pull for the system they are currently using.</li>
</ul>

<p>On the surface, this doesn&rsquo;t seem so bad. In practice it&rsquo;s painful for users and a nightmare for documentation. Below is an example of how tedious and error prone documenting running a container on the microPlatform is</p>

<p>arm:</p>

<pre><code>docker run -dit --net=host --read-only --tmpfs=/var/run -v /home/osf/nginx-lwm2m.conf:/etc/nginx/nginx.conf --add-host=mgmt.foundries.io:127.0.0.1 --name nginx-coap-proxy opensourcefoundries/nginx:latest-arm
</code></pre>

<p>arm64:</p>

<pre><code>docker run -dit --net=host --read-only --tmpfs=/var/run -v /home/osf/nginx-lwm2m.conf:/etc/nginx/nginx.conf --add-host=mgmt.foundries.io:127.0.0.1 --name nginx-coap-proxy opensourcefoundries/nginx:latest-arm64
</code></pre>

<p>amd64 (x86):</p>

<pre><code>docker run -dit --net=host --read-only --tmpfs=/var/run -v /home/osf/nginx-lwm2m.conf:/etc/nginx/nginx.conf --add-host=mgmt.foundries.io:127.0.0.1 --name nginx-coap-proxy opensourcefoundries/nginx:latest-amd64
</code></pre>

<p>Wouldn&rsquo;t it be nice if one command just worked across all these architectures?</p>

<h2 id="manifests">Manifests</h2>

<p>Docker has realized this is a serious problem for the ecosystem, and have taken steps in the right direction to solve it. They have added a image manifest in the v2 specification[0] which includes an <code>architecture</code> field to map a image reference to a specific architecture. Now images can be created and linked to a manifest, creating a single point of entry for users to consume multi-architecture images. Lets take another look at our example above, but instead using a manifest.</p>

<pre><code>docker run -dit --net=host --read-only --tmpfs=/var/run -v /home/osf/nginx-lwm2m.conf:/etc/nginx/nginx.conf --add-host=mgmt.foundries.io:127.0.0.1 --name nginx-coap-proxy opensourcefoundries/nginx:latest
</code></pre>

<p>One image reference to rule them all. The tag latest points to our image manifest, which in turn points to the image tags (i.e. latest-arm) for specific architectures. The result is a single entry point for our users, and sanity in our documentation.</p>

<h2 id="building">Building</h2>

<p>Architecture specific image layers need to be produced before an manifest can be created. Let&rsquo;s quickly dive into what is needed to do this, and discuss some limitations that Docker currently has.</p>

<h3 id="base-images">Base Images</h3>

<p>Take a look at your favorite Docker image, chances are the base image (FROM directive) is for a specific architecture. The solution to this problem is to create multi-architecture base images, to allow derivative images to inherit from. Therein lies the rub, most base images are not built for any other architecture other than the incubment amd64. We&rsquo;ve solved this problem by building and publishing our own base images for the architectures we support from upstream sources. Using the same manifest concept from above we can create multi-architecture base image based on upstream sources.</p>

<h4 id="minideb">Minideb</h4>

<p>Minideb[1] is a small image based on Debian designed for use in containers. We have created a CI server to rebuild these base images[2] for each architecture as the upstream changes. This allows us to quickly pick up the latest packages and security fixes and deliver them on multiple architectures seamlessly. Of course when the base images change, the dervative images must also be automatically rebuilt to ensure the security fixes flows downward.</p>

<h4 id="alpine">Alpine</h4>

<p>Alpine[3] Linux is a very minimal distribution, which makes it perfect for containers. The base images can be as small as 5MB, which helps keep the attack surfaces small, perfect for embedded hardware. The same principles above apply to our Alpine base images[4].</p>

<h3 id="limitations">Limitations</h3>

<p>Multi arch support is on the bleeding edge, so there are a few limitations to note.</p>

<ul>
<li>There is no offical tooling to create manifests.</li>
<li>Images must be built on the native architecture[5], bin-fmt and other workarounds do <em>not</em> work.</li>
<li>Manifest support requires Docker v1.12.6+</li>
</ul>

<p>[0] <a href="https://docs.docker.com/registry/spec/manifest-v2-1/">https://docs.docker.com/registry/spec/manifest-v2-1/</a></p>

<p>[1] <a href="https://github.com/bitnami/minideb">https://github.com/bitnami/minideb</a></p>

<p>[2]<a href="https://hub.docker.com/r/opensourcefoundries/minideb/">https://hub.docker.com/r/opensourcefoundries/minideb/</a></p>

<p>[3] <a href="https://github.com/gliderlabs/docker-alpine">https://github.com/gliderlabs/docker-alpine</a></p>

<p>[4] <a href="https://hub.docker.com/r/opensourcefoundries/alpine/">https://hub.docker.com/r/opensourcefoundries/alpine/</a></p>

<p>[5] <a href="https://github.com/docker/cli/issues/327">https://github.com/docker/cli/issues/327</a></p>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "osfoundries" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="https://opensourcefoundries.github.io/osfoundries-rendered/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/bluetooth">bluetooth (1)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/docker">docker (1)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/linux">linux (1)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/microplatform">microplatform (8)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/minutes">minutes (1)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/quickstart">quickstart (1)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/radio">radio (1)</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/categories/updates">updates (6)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/ble"><i class="fa fa-tags"></i> ble</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/bugs"><i class="fa fa-tags"></i> bugs</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/containers"><i class="fa fa-tags"></i> containers</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/cve"><i class="fa fa-tags"></i> cve</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/docker"><i class="fa fa-tags"></i> docker</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/k8s"><i class="fa fa-tags"></i> k8s</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/kubernetes"><i class="fa fa-tags"></i> kubernetes</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/linux"><i class="fa fa-tags"></i> linux</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/microplatform"><i class="fa fa-tags"></i> microplatform</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/open-source"><i class="fa fa-tags"></i> open-source</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/radio"><i class="fa fa-tags"></i> radio</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/resin"><i class="fa fa-tags"></i> resin</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/update"><i class="fa fa-tags"></i> update</a>
            </li>
            
            <li><a href="https://opensourcefoundries.github.io/osfoundries-rendered/tags/zephyr"><i class="fa fa-tags"></i> zephyr</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>About us</h4>

            We provide best-in-class software platforms with lifetime support for
    building and maintaining connected products, ranging from the smallest sensors to
    smart and edge devices. Our core products are Zephyr RTOS and Linux based microPlatforms,
    which provide product quality templates to build secure, OTA updatable, connected devices
    for industrial and consumer markets.

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

              

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>Contact</h4>

            <strong>Open Source Foundries Ltd.</strong>
        <br>Cambridge, UK
        <br><br><strong>Open Source Foundries Inc.</strong>
        <br>Boulder CO, USA
      </p>
      

            
            <a class="btn btn-template-main" role="button" href="/osfoundries-rendered/contact">Contact Us</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright 2018 Open Source Foundries Ltd. All rights reserved.</p>
            
            <p class="pull-right">
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-111281311-1', 'auto');
ga('send', 'pageview');
</script>

<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="https://opensourcefoundries.github.io/osfoundries-rendered/js/hpneo.gmaps.js"></script>
<script src="https://opensourcefoundries.github.io/osfoundries-rendered/js/gmaps.init.js"></script>
<script src="https://opensourcefoundries.github.io/osfoundries-rendered/js/front.js"></script>


<script src="https://opensourcefoundries.github.io/osfoundries-rendered/js/owl.carousel.min.js"></script>


  </body>
</html>
